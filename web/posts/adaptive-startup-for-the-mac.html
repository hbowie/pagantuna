<!DOCTYPE html>
<html lang="en">
<head>
	<title>Adaptive Startup for the Mac | Pagan Tuna</title>
  <!-- #bbinclude "head_stuff.html" -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Thoughts on Technology and Leadership from Herb Bowie">
    <meta name="author" content="Herb Bowie">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
    <link rel="icon" href="../favicon.png" type="image/png" />
    <link rel="alternate" type="application/rss+xml" title="What's New at Pagan Tuna" href="http://www.pagantuna.com/rss.xml" />
    <!-- Bootstrap -->
    <link href="../css/bootstrap.min.css" rel="stylesheet" media="screen">
    <!-- Custom styles for Pagan Tuna -->
    <link rel="stylesheet" href="../fonts/concourse_t3.css" type="text/css" />
    <link rel="stylesheet" href="../fonts/stylesheet.css" type="text/css" />
    <link rel="stylesheet" href="../css/styles.css" />
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.js"></script>
      <script src="../js/respond.min.js"></script>
    <![endif]-->

<!-- end bbinclude -->

</head>

<body>

  <!-- #bbinclude "header.html" -->
    <div class="container">
      <div id="header">
        <div id="logo">
          <a href="../index.html">
            <img alt="Pagan Tuna" src="../images/tuna5.gif" width="134" height="118">
          </a>
        </div>
        <div id="title-and-slogan">
          <div id="site-title">
            <a href="../index.html">
              Pagan Tuna
            </a>
          </div>
          <div id="site-slogan">
            Often irreverent<br />
            and sometimes downright fishy<br />
            thoughts on Technology and Leadership<br />
            by Herb Bowie
          </div>
        </div>
      </div>
<!-- end bbinclude -->

<!-- #bbinclude "nav.html" -->
      <!-- Static navbar -->
      <div id="nav" class="navbar navbar-default">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Pagan Tuna</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">

            <li class="dropdown">
              <a href="../index.html" class="dropdown-toggle" data-toggle="dropdown">Posts <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="../index.html">Most Recent</a></li>
                <li><a href="../posts/index-by-title.html">Titles</a></li>
                <li><a href="../posts/tags/index.html">Tags</a></li>
                <li><a href="javascript:randomPost();">Random</a></li>
                <li><a href="javascript:nextPost();">Next</a></li>
                <li><a href="javascript:priorPost();">Prior</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="../wisdom/index.html" class="dropdown-toggle" data-toggle="dropdown">Quotations <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="../wisdom/index-latest.html">Most Recent</a></li>
                <li><a href="../wisdom/authors/index.html">Authors</a></li>
                <li><a href="../wisdom/index-by-title.html">Titles</a></li>
                <li><a href="../wisdom/tags/index.html">Tags</a></li>
                <li><a href="javascript:randomQuote();">Random</a></li>
                <li><a href="javascript:nextQuote();">Next</a></li>
                <li><a href="javascript:priorQuote();">Prior</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="../about/herb-bowie.html" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="../about/herb-bowie.html">About the Author</a></li>
                <li><a href="../about/colophon.html">Colophon</a></li>
                <li><a href="../about/locker.html">Captain&apos;s Locker</a></li>
              </ul>
            </li>

            <li><a href="../rss.html">RSS</a></li>

            <li><a href="../search.html">Search</a></li>

          </ul>

        </div><!--/.nav-collapse -->
      </div>
<!-- end bbinclude -->

      <div id="body-container">
        <div id="center">
		      <p class="tags"><a href='tags/apple.html' rel='tag'>Apple</a>, <a href='tags/applescript.html' rel='tag'>AppleScript</a>, <a href='tags/mac.html' rel='tag'>Mac</a>, <a href='tags/technology.html' rel='tag'>Technology</a></p>
		      <h1>Adaptive Startup for the Mac</h1>

<p><img src="../images/apple-script-editor.jpg" alt="AppleScript icon" title="" align="right" /></p>

<p>How shall I start thee? Let me count the ways&#8230;. </p>

<p>Apple offers multiple approaches to launching selected applications when you start up your Mac. You can specify any number of Login Items as part of the Users &amp; Groups panel within your System Preferences. And of course, when shutting down with OS X Lion (10.7), you can leave the option checked to reopen windows when logging back in, so that your Mac starts up with the same apps and windows that were last open. </p>

<p>For me, at least, neither of these options has been entirely satisfactory. I&#8217;m in the habit of opening apps and windows and tabs throughout the day, then shutting my Mac down at night before I go to bed; when I start it up in the morning, I want to start fresh &#8212; not facing the leftover detritus from the day before. </p>

<p>On most mornings, when I start my Mac, I want it to open a standard set of apps and web pages so they&#8217;re ready for me when I sit down to my desk. On the other hand, if I&#8217;m traveling with my MacBook, or taking it in to the Genius Bar for assistance, I don&#8217;t want my computer to spend five minutes opening a dozen applications before I can wrest control away from it it &#8212; in those cases, I&#8217;d like a chance to abort the normal startup sequence, and launch apps on my own. </p>

<p>Being dissatisfied with the other solutions available, I finally took matters into my own hands and cobbled together the following <a href="http://en.wikipedia.org/wiki/AppleScript">AppleScript</a> program. While AppleScript is not for the faint of heart, neither is it only for the use of serious developers. If you&#8217;re not familiar with the language, have no fear: just fire up your AppleScript Editor application (found in your Utilities folder), then copy and paste the following code into a new window. You&#8217;ll want to customize it for your needs, but such modifications should be straightforward.</p>

<p>You can download the entire script from <a href="../files/adaptive-startup.applescript">this location</a>.</p>

<p>So without further preamble, let me walk you through the code, explaining what it does and how to modify it along the way.  (Note that the downloaded script also contains comments to explain the operation of the program; I won&#8217;t repeat those here, since I&#8217;ll be offering a fuller explanation as I go.)</p>

<p>One of the features of this script is that it writes a log file to your desktop explaining exactly what it did during its execution. We&#8217;ll store the log file in the user&#8217;s Desktop folder, with the name &#8220;Adaptive Startup Log.txt&#8221;. </p>

<p>So, to start with, let&#8217;s specify a few global variables that will be used for the logging operation.</p>

<pre><code>global logFilePath
global logFile
global lf
set lf to (ASCII character 10) as string
set logFilePath to (path to desktop as string) &amp; "Adaptive Startup Log.txt" as string
</code></pre>

<p>Now let&#8217;s delete the log file, if it already exists in your Desktop folder. </p>

<pre><code>tell application "System Events"
  set logExists to exists file "Adaptive Startup Log.txt" of desktop folder
end tell
if logExists then
  set logFileAlias to logFilePath as alias
  tell application "Finder" to delete logFileAlias
end if
</code></pre>

<p>Let&#8217;s open the log file so that we can write to it throughout the script.</p>

<pre><code>set logFile to open for access logFilePath with write permission
</code></pre>

<p>Ensure that this script is frontmost before we try to engage the user. </p>

<pre><code>activate
</code></pre>

<p>Now let&#8217;s give the user a chance to abort the script without doing anything else. We&#8217;ll start with a verbal announcement, then pop up a dialog box. We&#8217;ll give the user 30 seconds to respond to the dialog box, by either giving the OK to proceed, asking for more Choices, or telling us to Cancel. If we haven&#8217;t heard anything in 30 seconds, then we&#8217;ll assume the user has stepped away and wants us to proceed.  </p>

<pre><code>say "Startup sequence about to begin"
set go to true
try
  display dialog "Startup sequence about to begin" buttons {"Cancel", "Choices", "OK"} default button "OK" giving up after 30
  set selectedButton to button returned of the result
  if selectedButton = "OK" or selectedButton = "Choices" or gave up of the result = true then
    set go to true
  else
    set go to false
  end if
on error errStr
  if the errStr contains "User canceled" then
    set go to false
  else
    set go to true
  end if
end try
</code></pre>

<p>If the user has asked us to proceed, then see if they want a list of choices about which apps to launch. </p>

<pre><code>set choice to "My Usual Apps"
if go then
  if selectedButton = "Choices" then
    choose from list {"My Usual Apps", "My Writing Apps"}
    if result is false then
      set go to false
    else
      set choices to result
      set choice to item 1 of choices
    end if
  end if
end if
</code></pre>

<p>If we got the permission to go forward with the launch sequence, either explicitly or implicitly, then we&#8217;ll proceed with the bulk of the script. </p>

<pre><code>if go then
</code></pre>

<p>Now let&#8217;s write the first line to the log file, indicating the date and time at which we&#8217;re starting the script. Note that we&#8217;re using a subroutine called &#8220;writeLogLine&#8221; that will be defined later. </p>

<pre><code>  set eof of logFile to 0
  writeLogLine("Adaptive Startup launching at " &amp; (current date))
  writeLogLine(" ")
</code></pre>

<p>As part of my normal daily startup, I like to perform a little automated maintenance. I&#8217;ve got several backup folders that get new files added to them on a regular basis. Here&#8217;s where I toss out the old ones, keeping only the latest five backups, so that they don&#8217;t accumulate into some hellish mess. Modify to meet your needs, or delete this section altogether if you have no need for it. </p>

<pre><code>  set the homeFolder to path to home folder as string
  set the backupsFolder to the homeFolder &amp; "Backups:"

  set the pruneFolder to the backupsFolder &amp; "Bento Backups:"
  set the pruneAlias to the pruneFolder as alias
  deleteOldFilesFromFolder(pruneAlias, false, 5)

  set the pruneFolder to the backupsFolder &amp; "iWisdom Backups:"
  set the pruneAlias to the pruneFolder as alias
  deleteOldFilesFromFolder(pruneAlias, true, 5)

  set the pruneFolder to the backupsFolder &amp; "Moneydance Backups:"
  set the pruneAlias to the pruneFolder as alias
  deleteOldFilesFromFolder(pruneAlias, true, 5)

  set the pruneFolder to the backupsFolder &amp; "OmniFocus Backups:"
  set the pruneAlias to the pruneFolder as alias
  deleteOldFilesFromFolder(pruneAlias, true, 20)

  set the pruneFolder to the backupsFolder &amp; "Two Due Backups:"
  set the pruneAlias to the pruneFolder as alias
  deleteOldFilesFromFolder(pruneAlias, true, 5)

  set the pruneFolder to the backupsFolder &amp; "UMSeattle Backups:"
  set the pruneAlias to the pruneFolder as alias
  deleteOldFilesFromFolder(pruneAlias, true, 5)

  set the pruneFolder to the backupsFolder &amp; "URL Union Backups:"
  set the pruneAlias to the pruneFolder as alias
  deleteOldFilesFromFolder(pruneAlias, true, 5)

  writeLogLine(" ")
</code></pre>

<p>Here&#8217;s another maintenance task I like to start my day with: empty out the Downloads folder, and take out the Trash. Again, modify or delete altogether, in accordance with your preferences. </p>

<pre><code>  set myDownloadFolder to (path to downloads folder)
  tell application "Finder"
    delete items of myDownloadFolder
    empty trash
  end tell
  writeLogLine("Downloads folder thrown in the trash")
  writeLogLine("Trash emptied")
  writeLogLine(" ")
</code></pre>

<p>Now let&#8217;s log the choice the user made earlier about which set of apps to launch. </p>

<pre><code>  writeLogLine("Launching " &amp; choice)
</code></pre>

<p>Now let&#8217;s launch our first application, using a subroutine called &#8220;launchApp&#8221;. In addition to specifying the name of the application, we&#8217;ll pass a true/false indication of whether we want the app to be hidden after it is launched (to avoid cluttering up our screen with too many visible apps). </p>

<p>Note that any apps identified at this point will be launched irregardless of what set the user chose. </p>

<pre><code>  launchApp("LaunchBar", false)
</code></pre>

<p>Now let&#8217;s check and see whether we have an Internet connection. If not, then we&#8217;ll skip opening apps dependent on access to the &#8216;Net. Otherwise, once we&#8217;ve got the apps open, we&#8217;ll open a few Web pages we like to view first thing in the morning. </p>

<pre><code>  set internet_status to 1
  try
    do shell script "curl --connect-timeout 5 http://www.amazon.com"
  on error
    set internet_status to 0
  end try

  if (internet_status = 1) then
    writeLogLine("Internet is available")
  else
    writeLogLine("Internet is not available")
  end if
</code></pre>

<p>Now we&#8217;re going to check for the presence of an external drive (modify the name of the drive to match your setup). If the drive is present, then we&#8217;ll assume that we&#8217;re in our normal home configuration, and launch apps accordingly. If the drive is missing, then we&#8217;ll assume we&#8217;re mobile.</p>

<pre><code>  set extdrives to 0
  set file_server_status to 0
  tell application "Finder"
    if "HB HD Spring Clone" exists then
      set extdrives to 1
    end if
  end tell
</code></pre>

<p>If external drives are present, then launch apps dependent on them, and mount our home network file server. </p>

<pre><code>  if (extdrives = 1) then
    writeLogLine("External drives are available")
    launchApp("ChronoSync", false)
    tell application "Finder"
      try
        mount volume "afp://10.0.1.1" as user name "Herb Bowie" with password "password"
        set file_server_status to 1
      on error
        set file_server_status to 0
      end try
    end tell
</code></pre>

<p>If our file server mounted successfully, then we can launch any apps dependent on files only found there. </p>

<pre><code>    if (file_server_status = 1) then
      writeLogLine("Mounted Home Media Drive")
      launchApp("Moneydance", true)
    end if
  else
    writeLogLine("External drives are not available")
  end if
  writeLogLine(" ")
</code></pre>

<p>Now launch our favorite apps and Web pages, depending on the set chosen earlier, and on the other conditions detected. Note that we&#8217;re using <a href="http://www.fatcatsoftware.com/powertunes/">PowerTunes</a> from Fat Cat Software, rather than launching iTunes directly, so that we can specify which library we want it to use. </p>

<pre><code>  if choice = "My Usual Apps" then
    if (extdrives = 1) then
      launchApp("ChronoSync", true)
    end if

    launchApp("PowerTunes", true)
    tell application "PowerTunes"
      open library "iTunes"
    end tell
    launchApp("iCal", true)
    launchApp("OmniFocus", true)
    launchApp("BBEdit", true)
    launchApp("TextMate", true)
    launchApp("Two Due", false)

    -- Now launch apps dependent on the Internet
    if (internet_status = 1) then
      launchApp("Mail", true)
      launchApp("Safari", false)
      launchApp("App Store", true)
      launchApp("MacUpdate Desktop", true)
      launchApp("URL Union", true)

      open location "http://my.yahoo.com"
      open location "http://facebook.com"
      open location "http://www.swackett.com/app/"
    end if
</code></pre>

<p>We&#8217;re going to launch NetBeans with a separate try block, since it&#8217;s a hefty Java app that typically doesn&#8217;t launch quickly enough to be reported as successful by the activate routine. </p>

<pre><code>    try
      tell application "NetBeans 7.1.2"
        activate
      end tell
    end try

    delay 10

    tell application "Finder"
      set visible of process "NetBeans" to false
    end tell
    writeLogLine("Application " &amp; "NetBeans" &amp; " launched and hidden")
</code></pre>

<p>I&#8217;ve got a folder called &#8220;Active Projects&#8221; inside my home folder, and I put an alias there to anything I&#8217;m currently working on, so that it will open automatically at startup. </p>

<pre><code>    set the projects_folder to path to home folder as string
    set the projects_folder to the projects_folder &amp; "Active Projects:"
    set the projects_folder to the projects_folder as alias

    set the apps_folder to path to applications folder as string
    set omni_outliner to the apps_folder &amp; "OmniOutliner Professional.app"
    set omni_outliner to the omni_outliner as alias

    tell application "System Events" to get every disk item of the projects_folder whose visible is true
    set projects_files to result
    repeat with projects_file in projects_files
      tell application "System Events" to get name extension of projects_file
      if result is "oo3" then
        tell application "Finder"
          open projects_file using omni_outliner
        end tell
      else
        tell application "Finder"
          open projects_file
        end tell
      end if
      tell application "System Events" to get displayed name of projects_file
      writeLogLine("Opened file " &amp; result)
    end repeat
  end if
</code></pre>

<p>Here&#8217;s a separate routine for launching a more manageable set of apps geared to a particular purpose. </p>

<pre><code>  if choice = "My Writing Apps" then
    launchApp("TextMate", false)
    launchApp("Dictionary", false)
    launchApp("Two Due", false)
  end if
</code></pre>

<p>OK, let&#8217;s wrap things up. We&#8217;ll finish by opening the log file in whatever our default text editor happens to be, which signals that we&#8217;re done, and presents us with a nice neat record of what we&#8217;ve done. </p>

<pre><code>  writeLogLine(" ")
  writeLogLine("Adaptive Startup finishing at " &amp; (current date))

  close access logFile
  tell application "Finder"
    open logFilePath
  end tell
else
  close access logFile
end if
</code></pre>

<p>Aforementioned subroutines follow. </p>

<pre><code>on launchApp(appName, hide)
  try
    activate application ((path to applications folder as text) &amp; appName &amp; ".app")
    -- Let's pause for a few seconds, to give our app a chance to launch before we try to hide it
    delay 5

    if hide then
      tell application "Finder"
        set visible of process appName to false
      end tell
      writeLogLine("Application " &amp; appName &amp; " launched and hidden")
    else
      writeLogLine("Application " &amp; appName &amp; " launched")
    end if
  on error
    writeLogLine("Application " &amp; appName &amp; " could not be launched")
  end try
end launchApp

on deleteOldFilesFromFolder(pth, sortByDate, filesToKeep)
  writeLogLine("Reviewing files in " &amp; (pth))
  tell application "Finder"
    activate
    set filelist to files in pth
    if sortByDate then
      set filelist1 to (sort filelist by modification date)
    else
      set filelist1 to the reverse of (sort filelist by name)
    end if
  end tell
  set fileCount to 0
  repeat with oneFile in filelist1
    tell application "System Events" to get displayed name of oneFile
    set oneFileName to result
    tell application "System Events" to get modification date of oneFile
    set modDate to result
    set fileCount to fileCount + 1
    if fileCount ≤ filesToKeep then
      -- writeLogLine("Keeping " &amp; modDate &amp; " " &amp; oneFileName)
    else
      writeLogLine("Deleting " &amp; modDate &amp; " " &amp; oneFileName)
      tell application "Finder" to delete oneFile
    end if
  end repeat
end deleteOldFilesFromFolder

on writeLogLine(logLine)
  write logLine &amp; lf to logFile
end writeLogLine
</code></pre>

<p>There you have it! A fairly complete startup script that you can tailor to your liking, and a nice little tour of AppleScript capabilities along the way!</p>

<p>Once you&#8217;ve tweaked this for your situation and preferences, save it somewhere as a script and run it from within the Editor to test it out. When it&#8217;s working to your satisfaction, save it as an application within your Applications folder, then add it to your list of login items in System Preferences. </p>

<p>Other AppleScript resources:</p>

<ul>
<li><p><a href="https://developer.apple.com/library/mac/#documentation/AppleScript/Conceptual/AppleScriptX/AppleScriptX.html">Introduction to AppleScript Overview</a></p></li>
<li><p><a href="http://www.amazon.com/gp/product/0321149319/ref=as_li_qf_sp_asin_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=0321149319&linkCode=as2&tag=reasontorock-20">AppleScript 1-2-3</a></p></li>
<li><p><a href="http://macscripter.net/">MacScripter.net</a></p></li>
</ul>

          <p class="pub-date">July 7, 2012</p>
<p class="next">Next: <a href="tech-titans-compete.html">Tech Titans Compete</a></p>

        </div> <!-- end of multiple -->

	    </div> <!-- end of body row -->
  <!-- #bbinclude "footer.html" -->
	    <hr>

      <div id="footer-wrapper">
		    <div id="footer">
          Copyright &copy; 2005 - 2018 by Herb Bowie per this <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>, except where otherwise noted
		    </div>
	    </div>
    </div><!-- /.container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="../js/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/posts_navigate.js"></script>
    <script src="../js/wisdom_navigate.js"></script>
<!-- end bbinclude -->

</body>

</html>
